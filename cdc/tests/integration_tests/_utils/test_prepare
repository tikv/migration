#!/bin/bash

UP_TIDB_HOST=${UP_TIDB_HOST:-127.0.0.1}
UP_TIDB_PORT=${UP_TIDB_PORT:-4000}
UP_TIDB_OTHER_PORT=${UP_TIDB_OTHER_PORT:-4001}
UP_TIDB_STATUS=${UP_TIDB_STATUS:-10080}
UP_TIDB_OTHER_STATUS=${UP_TIDB_OTHER_STATUS:-10081}
DOWN_TIDB_HOST=${DOWN_TIDB_HOST:-127.0.0.1}
DOWN_TIDB_PORT=${DOWN_TIDB_PORT:-3306}
DOWN_TIDB_STATUS=${DOWN_TIDB_STATUS:-20080}
UP_TLS_TIDB_HOST=${UP_TLS_TIDB_HOST:-127.0.0.1}
UP_TLS_TIDB_PORT=${UP_TLS_TIDB_PORT:-3307}
UP_TLS_TIDB_STATUS=${UP_TLS_TIDB_STATUS:-30080}
DOWN_TLS_TIDB_HOST=${DOWN_TLS_TIDB_HOST:-127.0.0.1}
DOWN_TLS_TIDB_PORT=${DOWN_TLS_TIDB_PORT:-3308}
DOWN_TLS_TIDB_STATUS=${DOWN_TLS_TIDB_STATUS:-40080}

UP_PD_HOST_1=${UP_PD_HOST_1:-127.0.0.1}
UP_PD_PORT_1=${UP_PD_PORT_1:-2379}
UP_PD_PEER_PORT_1=${UP_PD_PEER_PORT_1:-2380}
UP_PD_HOST_2=${UP_PD_HOST_2:-127.0.0.1}
UP_PD_PORT_2=${UP_PD_PORT_2:-2679}
UP_PD_PEER_PORT_2=${UP_PD_PEER_PORT_2:-2680}
UP_PD_HOST_3=${UP_PD_HOST_3:-127.0.0.1}
UP_PD_PORT_3=${UP_PD_PORT_3:-2779}
UP_PD_PEER_PORT_3=${UP_PD_PEER_PORT_3:-2780}
DOWN_PD_HOST=${DOWN_PD_HOST:-127.0.0.1}
DOWN_PD_PORT=${DOWN_PD_PORT:-2479}
DOWN_PD_PEER_PORT=${DOWN_PD_PEER_PORT:-2480}
UP_TLS_PD_HOST=${UP_TLS_PD_HOST:-127.0.0.1}
UP_TLS_PD_PORT=${UP_TLS_PD_PORT:-2579}
UP_TLS_PD_PEER_PORT=${UP_TLS_PD_PEER_PORT:-2580}
DOWN_TLS_PD_HOST=${DOWN_TLS_PD_HOST:-127.0.0.1}
DOWN_TLS_PD_PORT=${DOWN_TLS_PD_PORT:-2589}
DOWN_TLS_PD_PEER_PORT=${DOWN_TLS_PD_PEER_PORT:-2590}

UP_TIKV_HOST_1=${UP_TIKV_HOST_1:-127.0.0.1}
UP_TIKV_PORT_1=${UP_TIKV_PORT_1:-20160}
UP_TIKV_STATUS_PORT_1=${UP_TIKV_STATUS_PORT_1:-20181}
UP_TIKV_HOST_2=${UP_TIKV_HOST_2:-127.0.0.1}
UP_TIKV_PORT_2=${UP_TIKV_PORT_2:-20161}
UP_TIKV_STATUS_PORT_2=${UP_TIKV_STATUS_PORT_2:-20182}
UP_TIKV_HOST_3=${UP_TIKV_HOST_3:-127.0.0.1}
UP_TIKV_PORT_3=${UP_TIKV_PORT_3:-20162}
UP_TIKV_STATUS_PORT_3=${UP_TIKV_STATUS_PORT_3:-20183}
DOWN_TIKV_HOST=${DOWN_TIKV_HOST:-127.0.0.1}
DOWN_TIKV_PORT=${DOWN_TIKV_PORT:-21160}
DOWN_TIKV_STATUS_PORT=${DOWN_TIKV_STATUS_PORT:-21180}
UP_TLS_TIKV_HOST=${UP_TLS_TIKV_HOST:-127.0.0.1}
UP_TLS_TIKV_PORT=${UP_TLS_TIKV_PORT:-22160}
UP_TLS_TIKV_STATUS_PORT=${UP_TLS_TIKV_STATUS_PORT:-22180}
DOWN_TLS_TIKV_HOST=${DOWN_TLS_TIKV_HOST:-127.0.0.1}
DOWN_TLS_TIKV_PORT=${DOWN_TLS_TIKV_PORT:-23160}
DOWN_TLS_TIKV_STATUS_PORT=${DOWN_TLS_TIKV_STATUS_PORT:-23180}

KAFKA_VERSION=$(cat /tmp/tikv_cdc_test/KAFKA_VERSION 2>/dev/null || echo 2.4.1)

# get sink uri of kafka
# usage: get_kafka_sink_uri <test_name>
function get_kafka_sink_uri() {
    TEST_NAME="$1"
    TOPIC_NAME="tikvcdc-$TEST_NAME-test-$RANDOM"
    echo "kafka://127.0.0.1:9092/$TOPIC_NAME?protocol=open-protocol&partition-num=4&kafka-version=$KAFKA_VERSION&max-message-bytes=10485760"
}

function stop_kafka_consumer() {
    cleanup_process cdc_kafka_consumer
}
